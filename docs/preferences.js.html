<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: preferences.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: preferences.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

const fs = require('fs');
const path = require('path');
const Utils = require('./utils');

/**
 * A thin OS wrapper that writes user preferences to a file.
 * @module lib/preferences
 * @author Dennis Thompson &lt;atomicpages@gmail.com>
 * @version 1.0.0
 */
module.exports = {

    _preferences: null,
    _file: path.join(Utils.home(), '.gencsv'),

    /**
     * @return {boolean} True if the `interactive` key is set in the user preferences file.
     */
    isInteractive: function () {
        return this.readPreferences('interactive');
    },

    /**
     * @return {boolean} True if the `always-use-headers` key is set in the user preferences file.
     */
    alwaysUseHeaders: function () {
        return this.readPreferences('always-use-headers');
    },

    /**
     * Saves a key and value pair to the preferences file.
     * @param {string} key The key to save.
     * @param {*} value The JSON-encodable value to set.
     * @param {function} [cb] The callback to execute after the file is written.
     * @async
     */
    save: function (key, value, cb) {
        if (!this._preferences) {
            this._preferences = this.loadPreferences();
        }

        this._preferences[key] = value;

        fs.writeFile(this._file, JSON.stringify(this._preferences), err => {
            if (err) {
                console.error('Unable to save preferences');
                console.error(err);
            }

            if (cb &amp;&amp; typeof cb === 'function') {
                cb();
            }
        });
    },

    /**
     * Truncates user preferences.
     * @param {function} [cb] The callback to execute is unlinking is successful.
     * @param {function} [errorCallback] The callback to execute in the event of an error.
     * @async
     */
    truncate: function (cb, errorCallback) {
        try {
            fs.unlinkSync(this._file);

            if (cb &amp;&amp; typeof cb === 'function') {
                cb();
            }
        } catch (e) {
            if (errorCallback &amp;&amp; typeof errorCallback === 'function') {
                errorCallback();
            }
        }
    },

    /**
     * @return {string} The absolute path to the preferences file.
     */
    file: function () {
        return this._file;
    },

    /**
     * Loads preferences into memory synchronously.
     * @return {object} Will return an object object if we're unable to load contents from
     * the file system.
     */
    loadPreferences: function () {
        let json = {};

        try {
            json = JSON.parse(fs.readFileSync(this._file));
        } catch (e) {
            // do nothing...
        }

        return json;
    },

    /**
     * Attempts to read user preferences and fetch data.
     * Cached in memory the first time we read the preferences.
     * @param {string} key The key to search for in the preferences file.
     * @return {boolean} False if no preferences file exists, otherwise the value of the key.
     */
    readPreferences: function (key) {
        if (!this._preferences) {
            this._preferences = this.loadPreferences();
        }

        return this._preferences &amp;&amp; this._preferences.hasOwnProperty(key) &amp;&amp; this._preferences[key];
    }

};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-lib_generator.html">lib/generator</a></li><li><a href="module-lib_preferences.html">lib/preferences</a></li><li><a href="module-lib_utils.html">lib/utils</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sun Jan 07 2018 16:38:49 GMT-0800 (PST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
